openapi: 3.0.3
info:
  title: å‹•æ…‹åœ°é»é¡å‹ API
  description: Green Map South å‹•æ…‹åœ°é»é¡å‹ç³»çµ±çš„ API åˆç´„
  version: 1.0.0

servers:
  - url: https://firestore.googleapis.com/v1/projects/{projectId}/databases/(default)/documents
    description: Firestore REST API

paths:
  /location_types:
    get:
      operationId: listLocationTypes
      summary: å–å¾—æ‰€æœ‰åœ°é»é¡å‹
      description: å–å¾—æ‰€æœ‰å•Ÿç”¨çš„åœ°é»é¡å‹åˆ—è¡¨ï¼Œç”¨æ–¼é¡å‹é¸æ“‡å’Œç¯©é¸
      parameters:
        - name: isActive
          in: query
          schema:
            type: boolean
          description: ç¯©é¸å•Ÿç”¨ç‹€æ…‹
      responses:
        '200':
          description: æˆåŠŸå–å¾—é¡å‹åˆ—è¡¨
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LocationType'
    
    post:
      operationId: createLocationType
      summary: å»ºç«‹åœ°é»é¡å‹
      description: å»ºç«‹æ–°çš„åœ°é»é¡å‹ï¼ˆåƒ…è¶…ç´šç®¡ç†å“¡ï¼‰
      security:
        - firebase: [superAdmin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLocationTypeRequest'
      responses:
        '201':
          description: é¡å‹å»ºç«‹æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LocationType'
        '400':
          description: é©—è­‰éŒ¯èª¤
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '403':
          description: æ¬Šé™ä¸è¶³

  /location_types/{typeId}:
    parameters:
      - name: typeId
        in: path
        required: true
        schema:
          type: string
        description: é¡å‹ ID
    
    get:
      operationId: getLocationType
      summary: å–å¾—å–®ä¸€é¡å‹
      responses:
        '200':
          description: æˆåŠŸå–å¾—é¡å‹
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LocationType'
        '404':
          description: é¡å‹ä¸å­˜åœ¨
    
    put:
      operationId: updateLocationType
      summary: æ›´æ–°åœ°é»é¡å‹
      security:
        - firebase: [superAdmin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateLocationTypeRequest'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LocationType'
        '403':
          description: æ¬Šé™ä¸è¶³
        '404':
          description: é¡å‹ä¸å­˜åœ¨
    
    delete:
      operationId: deleteLocationType
      summary: åˆªé™¤åœ°é»é¡å‹
      description: åˆªé™¤é¡å‹ï¼Œè‹¥æœ‰åœ°é»ä½¿ç”¨å‰‡éœ€æŒ‡å®šè™•ç†æ–¹å¼
      security:
        - firebase: [superAdmin]
      parameters:
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [deactivate, migrate]
          description: åˆªé™¤å‹•ä½œ
        - name: targetTypeId
          in: query
          schema:
            type: string
          description: è½‰ç§»ç›®æ¨™é¡å‹ IDï¼ˆåƒ… migrate æ™‚éœ€è¦ï¼‰
      responses:
        '200':
          description: åˆªé™¤æˆåŠŸ
        '400':
          description: åƒæ•¸éŒ¯èª¤
        '403':
          description: æ¬Šé™ä¸è¶³

  /location_types/{typeId}/usage:
    get:
      operationId: getTypeUsage
      summary: å–å¾—é¡å‹ä½¿ç”¨çµ±è¨ˆ
      parameters:
        - name: typeId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ä½¿ç”¨çµ±è¨ˆ
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    description: ä½¿ç”¨æ­¤é¡å‹çš„åœ°é»æ•¸é‡

  /locations:
    post:
      operationId: submitLocation
      summary: æäº¤åœ°é»
      description: æäº¤æ–°åœ°é»ï¼ˆéœ€é¸æ“‡é¡å‹ï¼‰
      security:
        - firebase: [authenticated]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitLocationRequest'
      responses:
        '201':
          description: æäº¤æˆåŠŸ
        '400':
          description: é©—è­‰éŒ¯èª¤

components:
  securitySchemes:
    firebase:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Firebase ID Token

  schemas:
    LocationType:
      type: object
      required:
        - id
        - name
        - icon
        - color
        - order
        - isActive
        - fieldSchema
        - createdAt
        - createdBy
      properties:
        id:
          type: string
          description: é¡å‹å”¯ä¸€è­˜åˆ¥ç¢¼
          example: "venue"
        name:
          type: string
          minLength: 3
          maxLength: 50
          description: é¡å‹åç¨±
          example: "åœ˜é›†æœƒå ´åœ°"
        description:
          type: string
          maxLength: 200
          description: é¡å‹æè¿°
          example: "é©åˆèˆ‰è¾¦åœ˜é›†æœƒæ´»å‹•çš„å ´åœ°"
        icon:
          type: string
          description: Emoji åœ–ç¤º
          example: "ğŸ¢"
        color:
          type: string
          pattern: "^#[0-9A-Fa-f]{6}$"
          description: æ¨™è¨˜é¡è‰² (HEX)
          example: "#4CAF50"
        order:
          type: integer
          minimum: 0
          description: æ’åºé †åº
          example: 1
        isActive:
          type: boolean
          description: æ˜¯å¦å•Ÿç”¨
          example: true
        fieldSchema:
          type: array
          maxItems: 20
          items:
            $ref: '#/components/schemas/FieldSchema'
        createdAt:
          type: string
          format: date-time
        createdBy:
          type: string
        updatedAt:
          type: string
          format: date-time
        updatedBy:
          type: string

    FieldSchema:
      type: object
      required:
        - fieldId
        - label
        - type
        - required
        - order
        - displayInList
        - displayInDetail
      properties:
        fieldId:
          type: string
          pattern: "^[a-z][a-zA-Z0-9]*$"
          description: æ¬„ä½å”¯ä¸€è­˜åˆ¥ç¢¼ (camelCase)
          example: "capacity"
        label:
          type: string
          minLength: 1
          maxLength: 50
          description: é¡¯ç¤ºæ¨™ç±¤
          example: "å®¹ç´äººæ•¸"
        type:
          $ref: '#/components/schemas/FieldType'
        required:
          type: boolean
          description: æ˜¯å¦å¿…å¡«
          example: true
        order:
          type: integer
          minimum: 0
          description: é¡¯ç¤ºé †åº
          example: 1
        placeholder:
          type: string
          maxLength: 100
          description: æç¤ºæ–‡å­—
          example: "è«‹è¼¸å…¥å¯å®¹ç´äººæ•¸"
        validation:
          $ref: '#/components/schemas/ValidationRule'
        options:
          type: array
          items:
            $ref: '#/components/schemas/FieldOption'
          description: é¸é …åˆ—è¡¨ (åƒ… select/multiSelect/radio/checkbox)
        displayInList:
          type: boolean
          description: æ˜¯å¦åœ¨åœ°åœ–æ¨™è¨˜é¡¯ç¤º
          example: true
        displayInDetail:
          type: boolean
          description: æ˜¯å¦åœ¨è©³æƒ…é¢æ¿é¡¯ç¤º
          example: true

    FieldType:
      type: string
      enum:
        - text
        - textarea
        - number
        - select
        - multiSelect
        - radio
        - checkbox
        - date
        - time
        - datetime
        - boolean
        - url
      description: æ¬„ä½é¡å‹

    ValidationRule:
      type: object
      properties:
        min:
          type: number
          description: æœ€å°å€¼/é•·åº¦
        max:
          type: number
          description: æœ€å¤§å€¼/é•·åº¦
        pattern:
          type: string
          description: æ­£è¦è¡¨é”å¼
        minLength:
          type: integer
          description: æœ€å°å­—å…ƒæ•¸
        maxLength:
          type: integer
          description: æœ€å¤§å­—å…ƒæ•¸

    FieldOption:
      type: object
      required:
        - value
        - label
      properties:
        value:
          type: string
          description: é¸é …å€¼
          example: "projector"
        label:
          type: string
          description: é¡¯ç¤ºæ¨™ç±¤
          example: "æŠ•å½±è¨­å‚™"
        disabled:
          type: boolean
          description: æ˜¯å¦åœç”¨
          default: false

    CreateLocationTypeRequest:
      type: object
      required:
        - name
        - icon
        - color
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 50
        description:
          type: string
          maxLength: 200
        icon:
          type: string
        color:
          type: string
          pattern: "^#[0-9A-Fa-f]{6}$"
        fieldSchema:
          type: array
          maxItems: 20
          items:
            $ref: '#/components/schemas/FieldSchema'

    UpdateLocationTypeRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 50
        description:
          type: string
          maxLength: 200
        icon:
          type: string
        color:
          type: string
          pattern: "^#[0-9A-Fa-f]{6}$"
        order:
          type: integer
          minimum: 0
        isActive:
          type: boolean
        fieldSchema:
          type: array
          maxItems: 20
          items:
            $ref: '#/components/schemas/FieldSchema'

    SubmitLocationRequest:
      type: object
      required:
        - name
        - address
        - typeId
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
        address:
          type: string
        description:
          type: string
        typeId:
          type: string
          description: åœ°é»é¡å‹ ID
        dynamicFields:
          type: object
          additionalProperties: true
          description: å‹•æ…‹æ¬„ä½å€¼

    ValidationError:
      type: object
      properties:
        code:
          type: string
          example: "VALIDATION_ERROR"
        message:
          type: string
          example: "é©—è­‰éŒ¯èª¤"
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              message:
                type: string
